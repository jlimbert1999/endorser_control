<div class="card mt-2">
  <p-toolbar>
    <div class="p-toolbar-group-start">
      <button
        pButton
        icon="pi pi-plus"
        class="mr-2"
        (click)="create()"
      ></button>
    </div>
    <div class="p-toolbar-group-center">
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input pInputText placeholder="Buscar aval ds" />
      </span>
    </div>
  </p-toolbar>
</div>

<div class="p-3">
  <p-table
    [value]="datasource()"
    [rows]="10"
    [paginator]="true"
    [tableStyle]="{ 'min-width': '50rem' }"
    [rowHover]="true"
    currentPageReportTemplate="{first} / {last} de {totalRecords}"
    [showCurrentPageReport]="true"
    styleClass="p-datatable-gridlines"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Nombre</th>
        <th>Organizacion social</th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td>{{ item.name }}</td>
        <td>{{ item?.organization?.name }}</td>
        <td>
          <p-button
            icon="pi pi-eye"
            [rounded]="true"
            [text]="true"
            (onClick)="viewDetail(item)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog
  (onHide)="close()"
  [(visible)]="visible"
  [style]="{ width: '600px' }"
  header="Registro aval"
  [modal]="true"
  styleClass="p-fluid"
>
  <ng-template pTemplate="content">
    <form [formGroup]="Form">
      <div class="field">
        <label for="name">Nombre del aval</label>
        <input
          type="text"
          pInputText
          id="name"
          formControlName="name"
          required
        />
      </div>

      <p-dropdown
        [options]="organizations()"
        formControlName="organization"
        [filter]="true"
        filterBy="name"
        [showClear]="true"
        placeholder="Buscar organizacion"
        emptyMessage="Sin resultados"
        emptyFilterMessage="Sin resultados"
        appendTo="body"
        optionValue="_id"
        (onFilter)="searchOrganizations($event.filter)"
      >
        <ng-template pTemplate="selectedItem" let-selectedOption>
          <div class="flex align-items-center gap-2">
            <div>{{ selectedOption.name }}</div>
          </div>
        </ng-template>
        <ng-template let-country pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ country?.name }}</div>
          </div>
        </ng-template>
      </p-dropdown>
    </form>
  </ng-template>
  <ng-template pTemplate="footer">
    <p-button
      label="Guardar"
      [disabled]="Form.invalid"
      (onClick)="save()"
    ></p-button>
  </ng-template>
</p-dialog>

<p-dialog
  header="Avalados"
  [(visible)]="dialogDetail"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '900px' }"
>
  @if (applicants.length>0) {
  <p-table [value]="applicants" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
      <tr>
        <th>Nro</th>
        <th>Nombre</th>
        <th>CI</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-product let-rowIndex="rowIndex">
      <tr>
        <td>{{ rowIndex + 1 }}</td>
        <td>
          {{ product.firstname }} {{ product.middlename }}
          {{ product.lastname }}
        </td>
        <td>{{ product.dni }}</td>
      </tr>
    </ng-template>
  </p-table>
  } @else {
  <p>Sin avalados</p>
  }
</p-dialog>
